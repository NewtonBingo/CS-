## 数据库原理

数据库（Database）是指一个有组织的数据集合，用于存储、管理和处理数据。通俗地说，数据库就是一个存储数据的仓库，可以对其中的数据进行添加、修改、查询、删除等操作。
- 数据库的概念：数据库是一个有组织的数据集合，用于存储、管理和处理数据。
- 数据库模型：数据库模型是描述数据组织和存储方式的方法，包括关系模型、层次模型、网状模型等。
- 数据库设计：数据库设计是根据需求设计和构建数据库的过程，包括概念设计、逻辑设计和物理设计。
``` bash  
*1.第一范式（1NF）：数据表中的每一列都应该是原子性的，不可再分。即每个属性都不可再拆分成其他属性。*  
*2.第二范式（2NF）：满足1NF，且表中的非主键属性必须完全依赖于主键，而不能只依赖于主键的一部分。即每个非主键属性都必须与主键完全相关。*  
*3.第三范式（3NF）：满足2NF，且表中的非主键属性不能依赖于其他非主键属性。即任何一个非主键属性不能由其他非主键属性推导出来。*  
*4.巴斯-科德范式（BCNF）：满足3NF，且表中的每个依赖关系都是由候选键决定的。即表中的每个属性都必须与候选键相关，不能只依赖于候选键的一部分。*  
*5.第四范式（4NF）：满足BCNF，且表中不存在多余的多对多关系。即不存在任何两个多值依赖于同一个非主属性的情况。*
```
- 关系数据库理论：关系数据库理论是描述关系数据库的基本概念、关系代数、范式等理论。
- SQL语言：SQL（Structured Query Language）是用于关系数据库中数据查询、更新、管理的标准语言。
- 数据库管理系统：数据库管理系统（DBMS）是用于管理数据库的软件系统，包括MySQL、Oracle、SQL Server等。
- 数据库安全性：数据库安全性是保护数据库的机密性、完整性和可用性，包括用户认证、访问控制、数据加密等方面。
- 数据库性能：数据库性能是指数据库在处理用户请求时的效率和响应速度，包括查询优化、索引设计、并发控制等方面。
- 数据库备份与恢复：数据库备份与恢复是为了防止数据丢失，采用数据备份和数据恢复策略。
- 数据库应用：数据库应用包括企业资源管理、客户关系管理、人力资源管理、物流管理、电子商务等方面。

## 关系型数据库
关系数据库（Relational Database）是指一种基于关系模型的数据库，通过表格（也称为关系）来组织和存储数据。在关系数据库中，每个表都有一个唯一的表名，而每个表由多个列（也称为字段）组成，每个列定义了一个数据类型。每行（也称为记录）则表示一个实例，也就是一条记录。
### MySQL
MySQL是一种开放源代码的关系型数据库管理系统DBMS。
![image](https://user-images.githubusercontent.com/107925483/230532277-f6aa8536-d3a5-4b1f-ad4f-6fff30543201.png)
MySQL的架构可以分为三个层次：客户端、服务端和存储引擎。  
- 客户端层：MySQL客户端层包括连接器、查询缓存和分析器等组件。其中连接器负责建立和维护客户端与服务端之间的连接；查询缓存负责缓存查询结果，提高查询速度；分析器负责解析SQL语句，并生成查询执行计划。
- 服务端层：MySQL服务端层包括了查询优化器、执行器和存储引擎API等组件。其中查询优化器负责分析查询执行计划，选择最优的查询方案；执行器负责执行查询语句，并将结果返回给客户端；存储引擎API负责管理数据的存储和访问。
- 存储引擎层：MySQL支持多种不同的存储引擎，如InnoDB、MyISAM、Memory等。每种存储引擎都有不同的特点和优劣，可以根据实际应用场景进行选择。存储引擎负责实现数据的存储、索引、更新和查询等操作。MySQL的存储引擎层可以被看作是MySQL的插件式存储引擎架构的一个实现。

#### SQL语句执行流程
![image](https://user-images.githubusercontent.com/107925483/230532861-7d1d36ea-ad19-415f-8229-5c92188d68f3.png)
#### MySQL的存储引擎对比
存储引擎是MySQL的组件，用于处理不同表类型的SQL操作。不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能，使用不同的存储引擎，还可以获得特定的功能。
使用哪一种引擎可以灵活选择，一个数据库中多个表可以使用不同引擎以满足各种性能和实际需求，使用合适的存储引擎，将会提高整个数据库的性能 。MySQL 中采用的是插件式存储引擎架构。
常见的存储引擎就 InnoDB、MyISAM、Memory、NDB。
##### InnoDB(默认) vs MyISAM
- InnoDB 支持事务，MyISAM 不支持事务。这是 MySQL 将默认存储引擎从 MyISAM 变成 InnoDB 的重要原因之一；
- InnoDB 支持外键，而 MyISAM 不支持。对一个包含外键的 InnoDB 表转为 MYISAM 会失败；
- InnoDB 是聚簇索引，MyISAM 是非聚簇索引。聚簇索引的文件存放在主键索引的叶子节点上，因此 InnoDB 必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。而 MyISAM 是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的。
- InnoDB 不保存表的具体行数，执行 select count(*) from table 时需要全表扫描。而 MyISAM 用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快；
- InnoDB 最小的锁粒度是行锁，MyISAM 最小的锁粒度是表锁。一个更新语句会锁住整张表，导致其他查询和更新都会被阻塞，因此并发访问受限。这也是 MySQL 将默认存储引擎从 MyISAM 变成 InnoDB 的重要原因之一；
![image](https://user-images.githubusercontent.com/107925483/230534925-7425ccb4-a3aa-441b-8e8e-d7ff87d839e2.png)
![image](https://user-images.githubusercontent.com/107925483/230535282-bf36d174-1072-4ac5-a130-a310ba007bb7.png)
#### 数据类型
![image](https://user-images.githubusercontent.com/107925483/230535413-03aad9d7-c1fe-459a-acc4-f4273fd4edf5.png)

#### 索引
MYSQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构，所以说索引的本质是：数据结构。
MySQL的索引是一种用于加速数据库查询的数据结构，它可以使查询更快速和高效。索引通常是根据一个或多个列创建的，MySQL会根据这些列的值来排序和查找数据。当查询请求数据时，MySQL会使用索引进行快速查找，而不是进行全表扫描，这可以大大提高查询效率和性能。  
优势：
- 提高数据检索效率，降低数据库IO成本
- 降低数据排序的成本，降低CPU的消耗
劣势：  
- 索引需要额外的存储空间：为了存储索引数据结构，需要在磁盘上分配一定的存储空间。对于大型数据库，这可能会导致额外的磁盘空间需求，从而增加存储成本。
- 索引会降低写操作的性能：当进行插入、更新或删除操作时，MySQL需要更新索引，这可能会导致额外的I/O操作，从而降低写操作的性能。
- 过多的索引可能会导致查询性能下降：虽然索引可以提高查询性能，但是过多的索引可能会导致查询性能下降。因为每个索引都需要占用存储空间，并且每个索引都需要维护，这可能会导致查询操作的性能变慢。
- 索引可能不适用于所有查询：不是所有的查询都适合使用索引。对于某些查询，全表扫描可能比使用索引更快。因此，需要根据具体的查询需求来选择是否创建索引。
- 索引需要定期维护：由于数据库的数据会随着时间不断变化，索引也需要进行定期维护。定期维护包括对索引进行重新构建、优化和压缩等操作，这可能会对数据库的性能产生一定的影响。
##### 索引分类
- B-Tree索引：B-Tree（平衡树）是一种常见的数据结构，用于实现数据库索引。在B-Tree索引中，每个节点可以包含多个键和指向其他节点的指针。B-Tree索引可以支持等值查询、范围查询和排序操作，是MySQL中最常用的索引类型。
- Hash索引：Hash索引是一种快速的索引类型，基于哈希表实现。在Hash索引中，数据被散列到一个固定大小的哈希表中，并且每个哈希值对应一个指向数据的指针。Hash索引只支持等值查询，不支持范围查询和排序操作。
- Full-text索引：Full-text索引是一种用于全文搜索的索引类型，可以加快包含文本内容的列的搜索速度。Full-text索引使用特殊的算法和数据结构来实现文本搜索，支持模糊匹配和自然语言搜索。
- R-Tree索引：R-Tree索引是一种空间索引类型，用于处理包含地理位置或几何图形的数据。R-Tree索引使用树形结构来组织空间数据，支持范围查询和空间搜索操作。
- 前缀索引：前缀索引是一种特殊的索引类型，用于在较大的文本字段上提高查询效率。前缀索引只对字段的前几个字符创建索引，而不是整个字段，从而可以减少索引的大小和复杂度，提高查询速度。
##### B+Tree索引
MyISAM 和 InnoDB 存储引擎，都使用 B+Tree的数据结构，它相对与 B-Tree结构，所有的数据都存放在叶子节点上，且把叶子节点通过指针连接到一起，形成了一条数据链表，以加快相邻数据的检索效率。
B+Tree是一种多路平衡查找树，用于实现数据索引。它的原理可以概括为以下几点：
- 树的结构：B+Tree是一棵多路平衡查找树，每个节点可以包含多个关键字和多个子节点。除了根节点和叶子节点外，其他节点至少有两个子节点。
- 关键字的排序：在B+Tree中，节点中的关键字必须按照从小到大的顺序进行排序。
- 叶子节点：B+Tree的所有叶子节点都在同一层，它们包含了所有数据记录的指针以及指向下一个叶子节点的指针。叶子节点之间通过指针连接起来，形成了一条数据记录的有序链表。
- 中间节点：除了叶子节点以外，B+Tree中的其他节点被称为中间节点。中间节点中只存储关键字，不存储数据，通过关键字可以快速定位到下一个节点。
- 根节点：B+Tree的根节点是一棵B-Tree，它可以包含任意多个子节点。
- 插入操作：对于一个新插入的数据，B+Tree会首先进行查找操作，找到插入位置的叶子节点。如果叶子节点未满，直接插入数据。否则，叶子节点需要进行分裂操作，将其中一半数据移动到一个新的叶子节点中，并将新叶子节点插入到中间节点中。
- 删除操作：对于一个要删除的数据，B+Tree首先进行查找操作，找到该数据所在的叶子节点。如果叶子节点中有其他数据，直接删除该数据即可。否则，需要将该叶子节点删除，并将与该节点相邻的其他叶子节点进行合并操作。
总的来说，B+Tree通过多路平衡的方式，将所有数据记录存储在叶子节点中，并且通过关键字在中间节点中建立索引，从而可以快速定位到需要查找的数据记录。B+Tree的平衡性和节点结构可以保证查询的时间复杂度稳定在O(log n)级别。
![image](https://user-images.githubusercontent.com/107925483/230541322-6ed2f6ce-c1f7-4c6e-bd4d-8a9e1a76a276.png)
#### 增删改查
![image](https://user-images.githubusercontent.com/107925483/230541231-3e17d789-c52b-4a5f-aed1-66b8facf1064.png)

![image](https://user-images.githubusercontent.com/107925483/230541971-9a10741d-8094-4023-a854-63b6b12a62cf.png)
#### MySQL的事务
事务是由一组SQL语句组成的逻辑处理单元，具有4个属性，通常简称为事务的ACID属性。
- A (Atomicity) 原子性：整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样
- C (Consistency) 一致性：在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏
- I (Isolation)隔离性：一个事务的执行不能其它事务干扰。即一个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务之间不能互相干扰
- D (Durability) 持久性：在事务完成以后，该事务所对数据库所作的更改便持久的保存在数据库之中，并不会被回滚
##### 隔离性--通过锁机制
![image](https://user-images.githubusercontent.com/107925483/230542139-0ede04c9-4ab1-44c3-b887-a6b9190500d0.png)
##### 持久性、原子性和一致性--通过日志机制
![image](https://user-images.githubusercontent.com/107925483/230542712-5a06f52f-8bfc-43d5-bfaf-8292c997ca9b.png)
- redo log（重做日志） 实现持久化和原子性
- undo log（回滚日志） 实现一致性
- 其他日志
``` bash
1.错误日志：记录出错信息，也记录一些警告信息或者正确的信息。
2.查询日志：记录所有对数据库请求的信息，不论这些请求是否得到了正确的执行。
3.慢查询日志：设置一个阈值，将运行时间超过该值的所有SQL语句都记录到慢查询的日志文件中。
4.二进制日志：记录对数据库执行更改的所有操作。
5.中继日志：中继日志也是二进制日志，用来给slave 库恢复
6.事务日志：重做日志redo和回滚日志undo
```



